"use strict";let AdvanceSearch={baseUrl:baseUrl,tsClient:null,selectedLocation:null,currentItem:-1,localityItems:[],filterItems:[],localityInput:document.getElementById("mobile-locality-search-input"),filterInput:document.getElementById("mobile-filters-search-input"),mobileLocalityFilterButton:document.getElementById("modal-locality-filter"),mobileAutoCompleteContainer:document.getElementById("autocomplete-items-holder"),gpsIcon:document.getElementById("mobile-gps_icon"),clearSearchFilter:document.getElementById('mobile-clear-filter-search'),localitySearchLoader:document.getElementById('mobile_city_search_loader'),filterSearchLoader:document.getElementById('mobile_filter_search_loader'),navigationLoader:document.getElementById('mobile_navigation_loader'),mobileCityPlaceholder:document.getElementById('mobile-city-placeholder'),mobileFilterPlaceholder:document.getElementById('mobile-filter-placeholder'),mobileModalCloseButton:document.getElementById('mobile-modal-close-button'),selectedSearchFilterValue:selectedSearchFilterValue,selectedSearchLocalityValue:locality_city,selectedCity:city_slug,selectedLocality:selectedLocality,appEnvironment:environment,cities:cities,indexesName:{},init:function(){this.selectedSearchLocalityValue=locality_city;this.selectedCity=city_slug;if(this.appEnvironment=='production'){this.indexesName={service:'prod_services',disease:'prod_diseases',doctor:'prod_doctors',hospital:'prod_hospitals',specialty:'prod_specializations',city:'prod_cities',locality:'prod_localities'};}else{this.indexesName={service:'test_services',disease:'test_diseases',doctor:'test_doctors',hospital:'test_hospitals',specialty:'test_specializations',city:'test_cities',locality:'test_localities'};}
const urlParams=new URLSearchParams(window.location.search);const myParam=urlParams.get('search');if(myParam=="true"){this.mobileLocalityFilterButton.click();}
this.tsClient=new Typesense.Client(appConfigs);this.setUpSelectedLocation();$('#search-modal').on('shown.bs.modal',event=>{if(event.relatedTarget.id=='modal-city-locality-filter'){setTimeout(()=>{this.localityInput.focus();},10);}
if(event.relatedTarget.id!=='modal-city-locality-filter'){setTimeout(()=>{this.filterInput.focus();},10);}
this.initLocation();this.filterInput.placeholder=searchBarPlaceholder;document.body.style.overflow="hidden";document.body.style.pointerEvents="none";});$('#search-modal').on('hidden.bs.modal',event=>{document.body.style.cssText='';});this.gpsIcon.addEventListener("click",this.getLocation.bind(this));this.localityDropdownSetup();this.filtersDropdownSetup();this.keydownEventHandler(this.localityInput);this.keydownEventHandler(this.filterInput);this.localityInput.addEventListener("focus",this.localityInputOnFocusHandler.bind(this));this.filterInput.addEventListener('focus',this.filterInputOnFocusHandler.bind(this));this.clearSearchFilter.addEventListener('click',this.clearSearchFilterInput.bind(this));searchInitialized=true;},localityInputOnFocusHandler:function(e){if(document.getElementById(e.target.id+"autocomplete-list")!==null){return;}
document.getElementById("line-loader").classList.add("active");if((this.localityItems.length==0&&e.target.value.length==0)||(this.localityItems.length==0&&e.target.value.length!==0)){setTimeout(this.defaultLocalityDropdownItems.bind(this),100);}else{setTimeout(this.renderLocalityDropdownItems.bind(this),100);}},filterInputOnFocusHandler:function(e){if(document.getElementById(e.target.id+"autocomplete-list")!==null){return;}
document.getElementById("line-loader").classList.add("active");if((this.filterItems.length==0&&e.target.value.length==0)||(this.filterItems.length==0&&e.target.value.length!==0)){setTimeout(this.defaultFiltersDropdownItems.bind(this),100);}else{setTimeout(this.renderFiltersDropdownItems.bind(this),100);}},initLocation:function(){this.localityInput.value=this.selectedLocation.name;if(this.mobileCityPlaceholder){this.mobileCityPlaceholder.textContent=this.selectedLocation.name;}},setUpSelectedLocation:function(){if(isVCLandingPage){if(!localStorage.getItem('visited_city')){this.selectedLocation={name:"Video Consultation",type:"city"};setCookie('visited_city','Video Consultation',60);}else{this.selectedLocation={name:"Video Consultation",type:"city"};setCookie('visited_city','Video Consultation',60);}}else{if(!localStorage.getItem('visited_city')){this.selectedLocation={name:"Lahore",type:"city"};setCookie('visited_city','Lahore',60);}else{if(localStorage.getItem('visited_city')=='Video Consultation'){this.selectedLocation={name:"Lahore",type:"city"};setCookie('visited_city','Lahore',60);}else{this.selectedLocation={name:localStorage.getItem('visited_city'),type:"city"};setCookie('visited_city',localStorage.getItem('visited_city'),60);}}}
var urlLocation=this.selectedLocation.name.toLowerCase()
let viewAllConditions=document.getElementById('view-all-conditions-btn')
if(viewAllConditions){viewAllConditions.href=`${baseUrl}pakistan/${urlLocation}/condition`;}
let searchFieldDesktop=document.getElementById('search-field-desktop');if(searchFieldDesktop){searchFieldDesktop.innerHTML=this.selectedLocation.name;}
let mobileCityPlaceholder=document.getElementById('mobile-city-placeholder');if(mobileCityPlaceholder){mobileCityPlaceholder.innerHTML=this.selectedLocation.name;}
let elems=document.getElementsByClassName('home-city-bind');if(elems.length>0){[...elems].forEach((element,index)=>{urlLocation=urlLocation.replace(/\s/g,"-");element.href=baseUrl+'pakistan/'+urlLocation+'/'+element.dataset.src;});}},getLocation:function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(position=>{this.detectLocationInit();this.getAddressFromGeoCode(position.coords.latitude,position.coords.longitude,(location,status)=>this.formatAddress(location,status,'geo'));},error=>{this.detectLocationInit();this.getLocationBasedOnIp((location,status)=>this.formatAddress(location,status,'ip'));});}},getAddressFromGeoCode:function(latitude,longitude,callback){fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&key=AIzaSyA6W5qpGaI5sLLW0gKTDFZvPbg8fh4-OrM`).then(resp=>resp.json()).then(response=>callback(response,'success')).catch(error=>callback(error,'error'));},getLocationBasedOnIp:function(callback){const geoIpUrl='https://api.ipify.org?format=json';fetch(geoIpUrl).then(resp=>{if(!resp.ok){throw new Error('Failed to fetch');}
return resp.json();}).then(response=>{const ipAddress=response.ip;const locationUrl=`https://ipapi.co/${ipAddress}/json/`;return fetch(locationUrl);}).then(resp=>{if(!resp.ok){throw new Error('Failed to fetch location data');}
return resp.json();}).then(locationData=>{callback(locationData,'success');}).catch(error=>{console.error('Error fetching location:',error);callback(error,'error');});},formatAddress:function(location,status,from){let cityName='Lahore';let fromDetectLocation=false;if(from=="ip"&&status=="success"&&location&&location.city){cityName=location.city;}
if(from=='geo'&&status=="success"&&location&&location.status=="OK"){location.results.forEach(function(address_component){if(address_component.types[0]=="locality"){cityName=address_component.address_components[0].long_name;if(this.cities.indexOf(cityName)==-1){cityName='Lahore';}
fromDetectLocation=true;return false;}});}
if(from=='geo'&&status=="success"&&location&&location.status=="OVER_QUERY_LIMIT"){this.getLocationBasedOnIp((location,status)=>this.formatAddress(location,status,'ip'));}
if(from=='geo'&&status=="success"&&location&&location.status=="REQUEST_DENIED"){this.getLocationBasedOnIp((location,status)=>this.formatAddress(location,status,'ip'));}
if(cityName==''||cityName==undefined||cityName==null||this.cities.indexOf(cityName)==-1){cityName='Lahore';}
this.selectedLocation={name:cityName,type:"city"};this.localityInput.value=cityName;localStorage.setItem('visited_city',cityName);setCookie('visited_city',cityName,60);this.detectLocationDone(fromDetectLocation);if(this.mobileCityPlaceholder){this.mobileCityPlaceholder.textContent=cityName;}},hideClearFilterSearch:function(){this.clearSearchFilter.style.setProperty("display","none","important");},showClearFilterSearch:function(){this.clearSearchFilter.style.setProperty("display","block");},clearSearchFilterInput:function(){this.hideClearFilterSearch();this.filterInput.value='';this.filterInput.dispatchEvent(new Event("input"));setTimeout(()=>this.filterInput.focus(),0);},formatString:function(str){return str?str.split('-').map(item=>item.charAt(0).toUpperCase()+item.slice(1)).join(' '):'';},ucFirst:function(str){if(str){return str.charAt(0).toUpperCase()+str.slice(1);}
return str;},detectLocationInit:function(){this.localityInput.disabled=true;this.localitySearchLoader.style.setProperty("display","block");this.gpsIcon.style.setProperty("display","none","important");},detectLocationDone:function(fromDetectLocation){if(fromDetectLocation==true){this.filterInput.dispatchEvent(new Event("input"));setTimeout(()=>this.filterInput.focus(),0);}
this.localityInput.disabled=false;this.localitySearchLoader.style.setProperty("display","none");this.gpsIcon.style.setProperty("display","block");},localityLoaderAdd:function(){this.localitySearchLoader.style.display='block';},localityLoaderRemove:function(){this.localitySearchLoader.style.display='none';this.localityInput.focus();},filterLoaderAdd:function(){this.filterSearchLoader.style.display='block';},filterLoaderRemove:function(){this.filterSearchLoader.style.display='none';this.filterInput.focus();},localityDropdownSetup:function(){const self=this;this.localityInput.addEventListener("input",this.debounce(function(e){let localityInputValue=self.localityInput.value;self.currentItem=-1;let extraItem=null;if(localityInputValue.length>2){self.localityLoaderAdd();const queries={'searches':[{'collection':self.indexesName.city,'q':localityInputValue.trim(),'query_by':'name',},{'collection':self.indexesName.locality,'q':localityInputValue.trim(),'query_by':'locality_name',},]}
self.tsClient.multiSearch.perform(queries,{"per_page":10}).then(function(content){self.localityItems=[];let results=content.results;let cities=self.formateTsDataAsAlgolia(results[0].hits);let localities=self.formateTsDataAsAlgolia(results[1].hits);self.localityItems=cities.concat(localities);if(self.localityItems&&self.localityItems.length==0){self.localityItems.push({type:'no-record',text:`No location found`});}else{self.localityItems=self.localityItems.filter(record=>record.type!=='no-record');}
self.renderLocalityDropdownItems();self.localityLoaderRemove();}).catch(function(error){console.log('Error occured while loading',error);});}else{if(localityInputValue.length==0){self.localityItems=[];self.defaultLocalityDropdownItems();}}}));},formateTsDataAsAlgolia:function(hits){let finHits=[];if(hits&&hits.length>0){hits.forEach(function(hit){finHits.push(hit.document);});}
return finHits;},keydownEventHandler:function(element){const self=this;element.addEventListener("keydown",function(e){let x=document.getElementById(this.id+"autocomplete-list");if(x){if(x.getElementsByClassName("no-result-item").length>0){return;}
x=x.getElementsByClassName("item-holder").length==0?x.getElementsByTagName("div"):x.getElementsByClassName("item-holder");}else{return;}
if(e.keyCode==40){self.currentItem++;self.addActive(x);}else if(e.keyCode==38){self.currentItem--;self.addActive(x);}else if(e.keyCode==13){e.preventDefault();if(self.currentItem>-1){if(x)x[self.currentItem].click();}}else if(e.keyCode==27){self.closeAllDropdowns();}else if(e.code=='Tab'&&e.shiftKey==true){}
let container=document.getElementsByClassName('autocomplete-items');if(container&&container[0]){let offsetHeightContainer=container[0].offsetHeight;let activeElement=container[0].querySelector('.autocomplete-active');if(activeElement!==null){let itemPosition=activeElement.offsetTop;let activeElementHeight=activeElement.offsetHeight;container[0].scrollTop=itemPosition;}}});},addActive:function(x){if(!x)return false;this.removeActive(x);if(this.currentItem>=x.length)this.currentItem=0;if(this.currentItem<0)this.currentItem=(x.length-1);x[this.currentItem].classList.add("autocomplete-active");},removeActive:function(x){for(let i=0;i<x.length;i++){x[i].classList.remove("autocomplete-active");}},closeAllDropdowns:function(elmnt){let x=document.getElementsByClassName("autocomplete-items");for(let i=0;i<x.length;i++){if(elmnt!=x[i]&&(elmnt!=this.localityInput&&elmnt!=this.filterInput)){x[i].parentNode.removeChild(x[i]);}}
this.currentItem=-1;},filtersDropdownSetup:function(){const self=this;this.filterInput.addEventListener("input",this.debounce(function(e){let filterInputValue=self.filterInput.value;let extraItem=null;self.currentItem=-1;if(filterInputValue.length>2){self.filterLoaderAdd();self.showClearFilterSearch();const queries={'searches':[{'collection':self.indexesName.disease,'q':filterInputValue.trim(),'query_by':'name',"per_page":2,"include_fields":"id, name, slug",},{'collection':self.indexesName.service,'q':filterInputValue.trim(),'query_by':'name',"per_page":2,"include_fields":"id, name, slug",},{'collection':self.indexesName.specialty,'q':filterInputValue.trim(),'query_by':'name, alternate_name, tag0, tag1, tag2, tag3, tag4, tag5',"per_page":7,},]};let hospitalParams={"collection":self.indexesName.hospital,"q":filterInputValue.trim(),"per_page":10,'query_by':'name',"include_fields":"id, name, image, city, locality, slug, address"};let doctorParams={"collection":self.indexesName.doctor,"q":filterInputValue.trim(),"per_page":8,"query_by":"title,name","sort_by":"is_bookable:desc","include_fields":"id, title, name, image, city, locality, primary_specialization, slug"};if(self.selectedLocation){if(self.selectedLocation.type=='locality'){extraItem={type:'no-record',text:`No result found`,city:self.selectedLocation.city_name,against:"locality"};hospitalParams.filter_by=`city:'${self.selectedLocation.city_name}' && locality:'${self.selectedLocation.locality_name}'`;doctorParams.filter_by=`cities:'${self.selectedLocation.city_name}' && locality:'${self.selectedLocation.locality_name}'`;}
if(self.selectedLocation.type=='city'){extraItem={type:'no-record',text:`No result found`,against:"city"};hospitalParams.filter_by=`city:'${self.selectedLocation.name}'`;doctorParams.filter_by=`cities:'${self.selectedLocation.name}'`;}}
queries.searches.push(hospitalParams);queries.searches.push(doctorParams);self.tsClient.multiSearch.perform(queries,{}).then(function(content){let results=content.results;self.filterItems=[];let urlPart=self.buildUrlForFilterItem();let conditions=self.formateConditions(self.formateTsDataAsAlgolia(results[0].hits),urlPart);let treatments=self.formateTreatments(self.formateTsDataAsAlgolia(results[1].hits),urlPart);let specialties=self.formateSpecialities(self.formateTsDataAsAlgolia(results[2].hits),urlPart);let firstGroup=conditions.concat(treatments);let length=7-firstGroup.length;let specialtyList=specialties.slice(0,length);self.filterItems=specialties.concat(firstGroup);let doctors=self.formateDoctors(self.formateTsDataAsAlgolia(results[4].hits),urlPart);let doctorHits=results[4].found;let hospitals=self.formateHospitals(self.formateTsDataAsAlgolia(results[3].hits),urlPart);let hospitalHits=results[3].found;if(doctors.length>0){self.filterItems.push({header:'doctor',url:doctorHits>doctors.length});self.filterItems=self.filterItems.concat(doctors);}
if(hospitals.length>0){self.filterItems.push({header:'hospital'});self.filterItems=self.filterItems.concat(hospitals);}
if(extraItem!==null&&self.filterItems.length==0){self.filterItems.push(extraItem);}else{self.filterItems=self.filterItems.filter(record=>{return record.type!=='no-record';});}
self.filterLoaderRemove();self.renderFiltersDropdownItems();}).catch(function(error){console.log(error);});}else{self.closeAllDropdowns();if(filterInputValue.length==0){self.filterItems=[];self.defaultFiltersDropdownItems();self.hideClearFilterSearch();}else if(filterInputValue.length>0&&filterInputValue.length<=2){if(self.filterItems.length==0){self.defaultFiltersDropdownItems();self.hideClearFilterSearch();return;}
self.renderFiltersDropdownItems();}}}))},renderFiltersDropdownItems:function(){if(this.filterItems&&this.filterItems.length>0){let filterInputValue=this.filterInput.value;let filterItemContainer=this.createAutocompleteContainer(this.filterInput);this.filterItems.forEach(result=>{let itemDiv=document.createElement("DIV");if(result.header&&result.header=='doctor'){itemDiv.className+="title-holder d-flex justify-content-between align-items-center w-100 bg-mediumgray px-3 py-2 border-0";if(result.url){itemDiv.innerHTML=`<span class="title pr-2 d-block">Doctors</span>`;filterItemContainer.appendChild(itemDiv);}else{itemDiv.innerHTML=`<span class="title pr-2 d-block">Doctors</span>`;filterItemContainer.appendChild(itemDiv);}
return;}
if(result.header&&result.header=='hospital'){itemDiv.className+="title-holder d-flex justify-content-between align-items-center w-100 bg-mediumgray px-3 py-2 border-0";itemDiv.innerHTML=`<span class="title pr-2 d-block"><span>Hospitals</span></span>`;filterItemContainer.appendChild(itemDiv);return;}
if(result.type&&result.type=='no-record'){itemDiv.classList.add("no-result-item");if(result.against=='locality'){itemDiv.innerHTML+=`<div class="no-result-holder mb-5 mb-md-3"><div class="eror-img-holder d-block text-center mb-3"><img src="${s3MdpkBucketBasePath}/frontend/assets/images/sad.png" alt="No Result" class="img-fluid" width="110px"></div>${result.text} <button type="button" class="btn od-btn-outline-primary btn-block mt-3 btn-search-city">Expand your search to ${result.city}</button></div>`;setTimeout(()=>itemDiv.querySelector('.btn-search-city').addEventListener("click",e=>this.filterClickHandler(e),true),10);}else{itemDiv.innerHTML+=`<div class="no-result-holder mb-5 mb-md-3"><div class="eror-img-holder d-block text-center mb-3"><img src="${s3MdpkBucketBasePath}/frontend/assets/images/sad.png" alt="No Result" class="img-fluid" width="110px"></div>${result.text}</div>`;}}else{itemDiv.setAttribute('class','item-holder');itemDiv.innerHTML+=`<span class="image-holder">
                                ${ result.image?(result.type=='doctor'?`<img src="${result.image}" alt="${result.type}" onerror="imgError(this)">`:`<img src="${result.image}" alt="${result.type}" onerror="hospImgError(this)">`):(result.type=='hospital'?`<img src="${result.image}" alt="${result.type}" onerror="hospImgError(this)">`:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250.89 250.89" height="15px" width="15px" fill="#a5a5a5"><g data-name="Layer 2"><g data-name="Layer 2"><rect x="208.41" y="173.75" width="14.89" height="84.21" transform="translate(-89.41 215.86) rotate(-45)"/><path d="M111.65,223.3A111.65,111.65,0,1,1,223.3,111.65,111.78,111.78,0,0,1,111.65,223.3Zm0-208.41a96.76,96.76,0,1,0,96.76,96.76A96.87,96.87,0,0,0,111.65,14.89Z"/></g></g></svg>`)}
                                </span>`;itemDiv.innerHTML+=`<div class="item-container">
                                    ${ result.name.replace(new RegExp(filterInputValue,'gi'),str=>`<strong>${str}</strong>`)}
                                    ${ result.type&&(result.type!=='misc'&&result.type!=='doctor'&&result.type!=='hospital')?`<span class="position-absolute doctor-designation"><span class="text-uppercase text-sm">${result.type.charAt(0).toUpperCase()+result.type.slice(1)}</span></span>`:''}
                                    ${ result.type&&result.type=='doctor'&&result.specialization!==null?`<span class="d-block od-text-midgray text-sm">${result.specialization}</span>`:''}
                                    ${ result.type&&result.type=='hospital'&&result.address!==null?`<div class="d-block od-text-midgray text-sm">${result.address}</div>`:''}
                                </div>`;itemDiv.addEventListener("click",e=>this.filterClickHandler(e),true);}
itemDiv.innerHTML+=`<span class="last" style="display:none"> ${JSON.stringify(result)}</span>`;filterItemContainer.appendChild(itemDiv);});document.getElementById("line-loader").classList.remove("active");}},defaultFiltersDropdownItems:function(){let filterItemContainer=this.createAutocompleteContainer(this.filterInput);let defaultFilters=`
            <div class="item-holder default-filter" data-name="Gynecologist" data-id="72" data-type="specialty" data-slug="gynecologist">Gynecologist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Gynecologist","id":72,"type":"specialty","slug":"gynecologist","pageUrl":"${this.buildUrlForFilterItem()}/gynecologist"}</span></div>
            <div class="item-holder default-filter" data-name="Skin Specialist" data-id="15" data-type="specialty" data-slug="dermatologist">Skin Specialist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Skin Specialist","id":15,"type":"specialty","slug":"dermatologist","pageUrl":"${this.buildUrlForFilterItem()}/dermatologist"}</span></div>
            <div class="item-holder default-filter" data-name="Child Specialist" data-id="52" data-type="specialty" data-slug="child-specialist">Child Specialist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Child Specialist","id":52,"type":"specialty","slug":"child-specialist","pageUrl":"${this.buildUrlForFilterItem()}/child-specialist"}</span></div>
            <div class="item-holder default-filter" data-name="Neurologist" data-id="36" data-type="specialty" data-slug="neurologist">Neurologist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Neurologist","id":36,"type":"specialty","slug":"neurologist","pageUrl":"${this.buildUrlForFilterItem()}/neurologist"}</span></div>
            <div class="item-holder default-filter" data-name="Orthopedic Surgeon" data-id="47" data-type="specialty" data-slug="orthopedic-surgeon">Orthopedic Surgeon<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Orthopedic Surgeon","id":47,"type":"specialty","slug":"orthopedic-surgeon","pageUrl":"${this.buildUrlForFilterItem()}/orthopedic-surgeon"}</span></div>
            <div class="item-holder default-filter" data-name="Gastroenterologist" data-id="22" data-type="specialty" data-slug="gastroenterologist">Gastroenterologist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Gastroenterologist","id":22,"type":"specialty","slug":"gastroenterologist","pageUrl":"${this.buildUrlForFilterItem()}/gastroenterologist"}</span></div>
            <div class="item-holder default-filter" data-name="Endocrinologist" data-id="19" data-type="specialty" data-slug="endocrinologist">Endocrinologist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Endocrinologist","id":19,"type":"specialty","slug":"endocrinologist","pageUrl":"${this.buildUrlForFilterItem()}/endocrinologist"}</span></div>
            <div class="item-holder default-filter" data-name="ENT Specialist" data-id="17" data-type="specialty" data-slug="ent-specialist">ENT Specialist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"ENT Specialist","id":17,"type":"specialty","slug":"ent-specialist","pageUrl":"${this.buildUrlForFilterItem()}/ent-specialist"}</span></div>
            <div class="item-holder default-filter" data-name="General Surgeon" data-id="23" data-type="specialty" data-slug="general-surgeon">General Surgeon<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"General Surgeon","id":23,"type":"specialty","slug":"general-surgeon","pageUrl":"${this.buildUrlForFilterItem()}/general-surgeon"}</span></div>
            <div class="item-holder default-filter" data-name="Heart Specialist" data-id="6" data-type="specialty" data-slug="cardiologist">Heart Specialist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Heart Specialist","id":6,"type":"specialty","slug":"cardiologist","pageUrl":"${this.buildUrlForFilterItem()}/cardiologist"}</span></div>
            <div class="item-holder default-filter" data-name="Pulmonologist" data-id="61" data-type="specialty" data-slug="pulmonologist">Pulmonologist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Pulmonologist","id":61,"type":"specialty","slug":"pulmonologist","pageUrl":"${this.buildUrlForFilterItem()}/pulmonologist"}</span></div>
            <div class="item-holder default-filter" data-name="Eye Specialist" data-id="76" data-type="specialty" data-slug="eye-specialist">Eye Specialist<span style="position:absolute;right:10px;"><span class="text-uppercase text-sm">Specialty</span></span><span class="last" style="display:none">{"name":"Eye Specialist","id":76,"type":"specialty","slug":"eye-specialist","pageUrl":"${this.buildUrlForFilterItem()}/eye-specialist"}</span></div>
        `;filterItemContainer.innerHTML=defaultFilters;let defaultFilterItems=filterItemContainer.querySelectorAll('.item-holder.default-filter');defaultFilterItems.forEach(item=>{item.addEventListener("click",this.filterClickHandler.bind(this));});document.getElementById("line-loader").classList.remove("active");},createAutocompleteContainer:function(element){this.closeAllDropdowns();let filterItemContainer=document.createElement("DIV");filterItemContainer.setAttribute("id",element.id+"autocomplete-list");filterItemContainer.setAttribute("class","autocomplete-items text-md");filterItemContainer.setAttribute('tabIndex',-1);this.mobileAutoCompleteContainer.appendChild(filterItemContainer);return filterItemContainer;},defaultLocalityDropdownItems:function(){let filterItemContainer=this.createAutocompleteContainer(this.localityInput);const defaultLocalities=`
            <div class="item-holder city-locality">Lahore<input type="hidden" value='{"name":"Lahore","id":1,"type":"city"}'></div>
            <div class="item-holder city-locality">Karachi<input type="hidden" value='{"name":"Karachi","id":2,"type":"city"}'></div>
            <div class="item-holder city-locality">Islamabad<input type="hidden" value='{"name":"Islamabad","id":3,"type":"city"}'></div>
            <div class="item-holder city-locality">Rawalpindi<input type="hidden" value='{"name":"Rawalpindi","id":4,"type":"city"}'></div>
            <div class="item-holder city-locality">Multan<input type="hidden" value='{"name":"Multan","id":7,"type":"city"}'></div>
            <div class="item-holder city-locality">Faisalabad<input type="hidden" value='{"name":"Faisalabad","id":5,"type":"city"}'></div>
            <div class="item-holder city-locality">Peshawar<input type="hidden" value='{"name":"Peshawar","id":6,"type":"city"}'></div>
            <div class="item-holder city-locality">Sargodha<input type="hidden" value='{"name":"Sargodha","id":57,"type":"city"}'></div>
            <div class="item-holder city-locality">Gujranwala<input type="hidden" value='{"name":"Gujranwala","id":8,"type":"city"}'></div>
            <div class="item-holder city-locality">Bahawalpur<input type="hidden" value='{"name":"Bahawalpur","id":12,"type":"city"}'></div>
        `;filterItemContainer.innerHTML=defaultLocalities;let itemHolders=filterItemContainer.querySelectorAll('.item-holder');itemHolders.forEach(itemHolder=>{itemHolder.addEventListener('click',this.localityClickHandler.bind(this));});document.getElementById("line-loader").classList.remove("active");},renderLocalityDropdownItems:function(){if(this.localityItems&&this.localityItems.length>0){let localityInputValue=this.localityInput.value;let localityItemContainer=this.createAutocompleteContainer(this.localityInput);this.localityItems.forEach(loc=>{let itemDiv=document.createElement("DIV");if(loc.type&&loc.type=='no-record'){itemDiv.classList.add("no-result-item");itemDiv.innerHTML+=loc.text;}else{itemDiv.classList.add('item-holder','city-locality');itemDiv.innerHTML+=`<div class="item-container">${loc.name.replace(new RegExp(localityInputValue,'gi'),str=>`<strong>${str}</strong>`)}</div>`;itemDiv.innerHTML+="<input type='hidden' value='"+JSON.stringify(loc)+"'>";itemDiv.addEventListener("click",e=>this.localityClickHandler(e));}
localityItemContainer.appendChild(itemDiv);});document.getElementById("line-loader").classList.remove("active");}},localityClickHandler:function(e){let itemHolder=e.target.className.indexOf('item-holder')?e.target.closest('.item-holder'):e.target;this.selectedLocation=JSON.parse(itemHolder.getElementsByTagName("input")[0].value);this.localityInput.value=this.selectedLocation.name;if(this.filterInput.value.trim().length==0){this.filterInput.dispatchEvent(new Event("click"));setTimeout(()=>this.filterInput.focus(),0);}else if(this.filterInput.value.trim().length>2){this.filterInput.dispatchEvent(new Event("input"));setTimeout(()=>this.filterInput.focus(),0);}
if(this.mobileCityPlaceholder){const cityName=this.selectedLocation.type=='city'?this.selectedLocation.name:this.selectedLocation.city_name;this.mobileCityPlaceholder.textContent=cityName;}
this.closeAllDropdowns();},filterClickHandler:function(e){let itemHolder=e.target.closest('.item-holder');let item=null;if(itemHolder==null){let noResultElement=e.target.getElementsByClassName('last').length==0?e.target.closest('.no-result-item').getElementsByClassName('last'):e.target.getElementsByClassName('last');item=noResultElement[0].innerHTML}else{item=itemHolder.getElementsByClassName('last')[0].innerHTML;}
const fieldData=JSON.parse(item);if(fieldData.type&&fieldData.type!=='no-record'){if(fieldData.type!=="misc"){this.filterInput.value=fieldData.name;}
if(this.selectedLocation&&this.selectedLocation.type=='locality'){localStorage.setItem('visited_city',this.selectedLocation.city_name);setCookie('visited_city',this.selectedLocation.city_name,60);}
if(this.selectedLocation&&this.selectedLocation.type=='city'){localStorage.setItem('visited_city',this.selectedLocation.name)
setCookie('visited_city',this.selectedLocation.name,60);}
if(fieldData.pageUrl){if("ga"in window){let tracker=ga.getAll()[0];if(tracker){let self=this;tracker.send("event","Search","Tapped multi-faceted search suggestion",fieldData.pageUrl,{hitCallback:function(){self.navigationLoader.style.display='flex';window.location.href=fieldData.pageUrl;}});}else{this.navigationLoader.style.display='flex';window.location.href=fieldData.pageUrl;}}else{this.navigationLoader.style.display='flex';window.location.href=fieldData.pageUrl;}}}else{if(fieldData.against=='locality'){this.selectedLocation={name:fieldData.city,type:"city"};this.localityInput.value=fieldData.city;this.filterInput.dispatchEvent(new Event("input"));}}},seeAllSearchDoctorsHandler:function(e){e.preventDefault();if(this.selectedLocation&&this.selectedLocation.type=='locality'){localStorage.setItem('visited_city',this.selectedLocation.city_name);setCookie('visited_city',this.selectedLocation.city_name,60);}
if(this.selectedLocation&&this.selectedLocation.type=='city'){localStorage.setItem('visited_city',this.selectedLocation.name)
setCookie('visited_city',this.selectedLocation.name,60);}
this.navigationLoader.style.display='flex';window.location.href=e.target.href;},buildUrlForFilterItem:function(){let city='Lahore';let locality='';if(this.selectedLocation&&this.selectedLocation.type=='locality'){city=this.selectedLocation.city_name;locality=this.selectedLocation.slug;}else if(this.selectedLocation&&this.selectedLocation.type=='city'){city=this.selectedLocation.name;}
city=city.replace(/\s+/g,'-');if(locality!=''){return `${location.origin}/pakistan/${city}/${locality}`.toLowerCase();}
return `${location.origin}/pakistan/${city}`.toLowerCase();},formateConditions:function(hits,urlPart){let conditions=[];hits.forEach(item=>{conditions.push({id:item.id,name:item.name,image:item.image,type:'Condition',pageUrl:`${urlPart}/condition/${item.slug}`.toLowerCase()});});return conditions;},formateTreatments:function(hits,urlPart){let treatments=[];hits.forEach(item=>{treatments.push({id:item.id,name:item.name,image:item.image,type:'Service',pageUrl:`${urlPart}/treatment/${item.slug}`.toLowerCase()});});return treatments;},formateSpecialities:function(hits,urlPart){let specialties=[];hits.forEach(item=>{let specialty=item.name;if(item._rankingInfo){const fieldIndex=Math.round(item._rankingInfo.firstMatchedWord/1000);if(fieldIndex==0){specialty=item.name;}else if(fieldIndex==1){specialty=(item.alternate_name==""?item.name:item.alternate_name);}else if(fieldIndex>1){let tagIndex=fieldIndex-2;specialty=item['tag'+tagIndex];}}
specialties.push({id:item.id,name:specialty,image:item.image,type:'speciality',pageUrl:`${urlPart}/${item.slug}`.toLowerCase()});});return specialties;},formateHospitals:function(hits,urlPart){let hospitals=[];hits.forEach(item=>{hospitals.push({id:item.id,name:item.name,image:item.image,type:'hospital',address:item.address,pageUrl:`${urlPart}/h/${item.slug}/${item.id}`.toLowerCase()});});return hospitals;},formateDoctors:function(hits,urlPart){let doctors=[];let labs=['Pathology Lab','Radiology Lab'];hits.forEach(item=>{const primary_specialization=item.primary_specialization?item.primary_specialization.trim().split(" ").join("-"):item.primary_specialization;const is_lab=item.primary_specialization&&labs.includes(item.primary_specialization.split()[0]);doctors.push({id:item.id,name:`${item.title?item.title:(is_lab?'':'Dr.')} ${item.name}`,image:item.image,type:'doctor',specialization:item.primary_specialization,pageUrl:`${urlPart}/dr/${primary_specialization}/${item.slug}/${item.id}`.toLowerCase()});});return doctors;},debounce:function(fn,timeDelay=300){let timer;return()=>{clearTimeout(timer);timer=setTimeout(()=>fn(),timeDelay);};}};